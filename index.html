<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="default"/>
<meta name="theme-color" content="#FAFAF8"/>
<title>Drive</title>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent}
html{background:#FAFAF8;font-family:'Plus Jakarta Sans',sans-serif;color:#1A1A1A;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
body{min-height:100vh;min-height:100dvh;padding-bottom:80px;background:#FAFAF8}
input[type="date"]{font-family:'Plus Jakarta Sans',sans-serif}
::-webkit-scrollbar{width:0;display:none}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:translateY(0)}}
@keyframes fadeIn{from{opacity:0}to{opacity:1}}
.fade-up{animation:fadeUp .35s ease-out both}
.fade-in{animation:fadeIn .3s ease-out both}
</style>
</head>
<body>
<div id="root"></div>
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
<script crossorigin src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
<script type="text/babel">
const {useState,useEffect,useCallback,useMemo,useRef}=React;

const RAHENY="RSA+Raheny+Driving+Test+Centre,+All+Saints+Park,+Raheny,+Dublin+5";
const KILLESTER="RSA+Killester+Driving+Test+Centre,+St+Brigids+Parish+Resource+Centre,+306+Howth+Rd,+Dublin+5";

const ROUTES=[
  {id:"r1",name:"Clontarf Coastal Loop",centre:"Raheny",difficulty:3,duration:35,distance:"12.9km",
    description:"Watermill Rd ‚Üí coast ‚Üí Mount Prospect ‚Üí Baymount ‚Üí Conquer Hill ‚Üí Chelsea Gardens ‚Üí Vernon Ave",
    focus:["hill start","lane changes","narrow roads","reverse","turnabout"],
    origin:RAHENY,dest:RAHENY,
    addressWaypoints:["Watermill+Road,+Raheny,+Dublin","Clontarf+Road+near+Bull+Wall,+Clontarf,+Dublin+3","Mount+Prospect+Avenue,+Clontarf,+Dublin+3","Baymount+Park,+Clontarf,+Dublin","Conquer+Hill+Road,+Clontarf,+Dublin","Chelsea+Gardens,+Clontarf,+Dublin","Vernon+Avenue,+Clontarf,+Dublin"],
    waypoints:[{name:"Raheny Centre",lat:53.3764,lng:-6.1784,type:"start"},{name:"Watermill Road",lat:53.3772,lng:-6.1711,type:"waypoint"},{name:"Clontarf Road",lat:53.3603,lng:-6.2000,type:"hazard",note:"Narrows to one vehicle width"},{name:"Mount Prospect",lat:53.3669,lng:-6.1942,type:"manoeuvre",note:"Hill start ‚Äî handbrake fully up"},{name:"Baymount Park",lat:53.3678,lng:-6.1742,type:"manoeuvre",note:"Reverse into Baymount Park"},{name:"Conquer Hill",lat:53.3596,lng:-6.1897,type:"hazard",note:"Staggered junction"},{name:"Chelsea Gardens",lat:53.3626,lng:-6.1898,type:"manoeuvre",note:"Turnabout ‚Äî very narrow"},{name:"Vernon Avenue",lat:53.3644,lng:-6.1953,type:"waypoint"}],
    hazards:["Road narrows to one vehicle width","Lane changes after hatch markings","Steep hill start","Extremely narrow turnabout"],
    tips:["Check right mirror past hatched markings","1st gear for right at mini roundabouts","Park tight to kerb before turnabout"]},
  {id:"r2",name:"Raheny Village",centre:"Raheny",difficulty:2,duration:23,distance:"7.7km",
    description:"Village ‚Üí Harmonstown Rd ‚Üí Springdale ‚Üí Ennafort ‚Üí return",
    focus:["mini roundabouts","speed ramps","observation","residential"],
    origin:RAHENY,dest:RAHENY,
    addressWaypoints:["Main+Street,+Raheny,+Dublin+5","Harmonstown+Road,+Raheny,+Dublin+5","Springdale+Road,+Raheny,+Dublin+5","Ennafort+Park,+Raheny,+Dublin+5"],
    waypoints:[{name:"Raheny Centre",lat:53.3764,lng:-6.1784,type:"start"},{name:"Main St",lat:53.3808,lng:-6.1800,type:"hazard",note:"Busy junction, pedestrians"},{name:"Harmonstown Rd",lat:53.3830,lng:-6.1750,type:"waypoint"},{name:"Springdale Rd",lat:53.3840,lng:-6.1700,type:"hazard",note:"Speed ramps ‚Äî 2nd gear"},{name:"Ennafort",lat:53.3835,lng:-6.1680,type:"manoeuvre",note:"Turnabout and reverse"}],
    hazards:["Multiple narrow roundabouts","Speed ramps","School zones 8:30 & 15:00","Parked cars narrow road"],
    tips:["MSPSL at every junction","Yield to right at roundabouts","1m clearance from parked cars"]},
  {id:"r3",name:"Artane Roundabout",centre:"Raheny",difficulty:4,duration:30,distance:"8.1km",
    description:"Howth Rd ‚Üí Artane Castle roundabout ‚Üí Kilmore Rd. #1 fail location.",
    focus:["roundabout lanes","traffic lights","right turns"],
    origin:RAHENY,dest:RAHENY,
    addressWaypoints:["Howth+Road,+Raheny,+Dublin+5","Artane+Castle+Shopping+Centre,+Artane,+Dublin+5","Kilmore+Road,+Artane,+Dublin+5"],
    waypoints:[{name:"Raheny Centre",lat:53.3764,lng:-6.1784,type:"start"},{name:"Howth Road",lat:53.3802,lng:-6.1763,type:"hazard",note:"Busy main road"},{name:"Artane Roundabout",lat:53.3837,lng:-6.2149,type:"hazard",note:"#1 fail ‚Äî lane position critical"},{name:"Kilmore Road",lat:53.3861,lng:-6.2162,type:"waypoint"}],
    hazards:["Right turn at lights ‚Äî top fail","Roundabout lane position","Offside-to-offside confusion","Progress at lights"],
    tips:["Green = proceed to middle, wait, turn","Follow road markings at roundabout","Let other driver commit first"]},
  {id:"r4",name:"Killester Residential",centre:"Killester",difficulty:1,duration:16,distance:"5.3km",
    description:"Quiet residential ‚Üí Howth Rd ‚Üí Cill Eanna. Confidence builder.",
    focus:["smooth starts","basic junctions","observation","GOSHO"],
    origin:KILLESTER,dest:KILLESTER,
    addressWaypoints:["Killester+Avenue,+Dublin+5","Howth+Road,+Killester,+Dublin+5","Cill+Eanna,+Raheny,+Dublin+5"],
    waypoints:[{name:"Killester Centre",lat:53.3759,lng:-6.1968,type:"start"},{name:"Killester Ave",lat:53.3752,lng:-6.2094,type:"waypoint"},{name:"Howth Road",lat:53.3802,lng:-6.1763,type:"hazard",note:"Main road ‚Äî match speed"},{name:"Cill Eanna",lat:53.3796,lng:-6.1826,type:"manoeuvre",note:"Reverse around corner"}],
    hazards:["Speed ramps","Parked cars","Cycle lanes","Pedestrian crossings"],
    tips:["GOSHO every stop","Build confidence here","Smooth starts ‚Äî no jerking"]},
  {id:"r5",name:"Dollymount Coast",centre:"Raheny",difficulty:3,duration:30,distance:"10.1km",
    description:"Watermill ‚Üí Clontarf coast (Dollymount) ‚Üí St Assam's ‚Üí return",
    focus:["lane changes","narrow roads","reverse","observation"],
    origin:RAHENY,dest:RAHENY,
    addressWaypoints:["Watermill+Road,+Raheny,+Dublin","Clontarf+Road,+Dollymount,+Dublin+3","St+Assams+Road,+Raheny,+Dublin+5"],
    waypoints:[{name:"Raheny Centre",lat:53.3764,lng:-6.1784,type:"start"},{name:"Watermill Rd",lat:53.3772,lng:-6.1711,type:"waypoint"},{name:"Clontarf Rd",lat:53.3603,lng:-6.2000,type:"hazard",note:"Lane changes, hatch markings"},{name:"St Assam's",lat:53.3809,lng:-6.1710,type:"manoeuvre",note:"Reverse around corner"}],
    hazards:["Narrow approaches","Lane changes","Hatch markings","Coastal wind"],
    tips:["Signal early","Drop speed for narrowing","Firm grip in wind"]},
  {id:"r6",name:"Harmonstown Deep",centre:"Killester",difficulty:2,duration:24,distance:"7.3km",
    description:"Harmonstown ‚Üí Avondale Park ‚Üí Brookwood Ave ‚Üí return",
    focus:["turnabout","hill start","residential","give-way"],
    origin:KILLESTER,dest:KILLESTER,
    addressWaypoints:["Harmonstown+Road,+Raheny,+Dublin+5","Avondale+Park,+Raheny,+Dublin+5","Brookwood+Avenue,+Artane,+Dublin+5"],
    waypoints:[{name:"Killester Centre",lat:53.3759,lng:-6.1968,type:"start"},{name:"Harmonstown Rd",lat:53.3810,lng:-6.1880,type:"waypoint"},{name:"Avondale Park",lat:53.3825,lng:-6.1850,type:"manoeuvre",note:"Turnabout in cul-de-sac"},{name:"Brookwood Ave",lat:53.3840,lng:-6.1900,type:"manoeuvre",note:"Hill start ‚Äî moderate slope"}],
    hazards:["Tight cul-de-sacs","Children in estates","Uneven surfaces","Multiple give-ways"],
    tips:["Check all around before reversing","Bite point ‚Üí handbrake ‚Üí mirror ‚Üí go","30-40km/h in residential"]},
  {id:"r7",name:"Edenmore Extension",centre:"Raheny",difficulty:4,duration:33,distance:"10.4km",
    description:"Edenmore ‚Üí Artane Castle ‚Üí Malahide Rd ‚Üí return",
    focus:["roundabouts","gap selection","lane discipline","hill start"],
    origin:RAHENY,dest:RAHENY,
    addressWaypoints:["Edenmore+Drive,+Raheny,+Dublin+5","Artane+Castle+Shopping+Centre,+Artane,+Dublin+5","Malahide+Road,+Artane,+Dublin+5"],
    waypoints:[{name:"Raheny Centre",lat:53.3764,lng:-6.1784,type:"start"},{name:"Edenmore",lat:53.3830,lng:-6.1780,type:"waypoint"},{name:"Artane Castle",lat:53.3837,lng:-6.2149,type:"hazard",note:"Mini roundabouts in succession"},{name:"Malahide Rd",lat:53.3870,lng:-6.2050,type:"hazard",note:"Fast traffic ‚Äî gap selection"}],
    hazards:["Multiple roundabouts","Fast Malahide Rd traffic","Lane discipline","Bus lanes"],
    tips:["Scan markings 50m ahead","Don't force gaps","Bus lanes: 7-10am & 4-7pm Mon-Sat"]},
  {id:"r8",name:"Full Test Simulation",centre:"Raheny",difficulty:5,duration:42,distance:"13.4km",
    description:"Every manoeuvre, every terrain, all hazards. The gauntlet.",
    focus:["everything","endurance","test simulation"],
    origin:RAHENY,dest:RAHENY,
    addressWaypoints:["Raheny+Road,+Raheny,+Dublin+5","Artane+Castle+Shopping+Centre,+Artane,+Dublin+5","Clontarf+Road,+Dollymount,+Dublin+3","Ennafort+Park,+Raheny,+Dublin+5","Cill+Eanna,+Raheny,+Dublin+5"],
    waypoints:[{name:"Raheny Centre",lat:53.3764,lng:-6.1784,type:"start"},{name:"Raheny Hill",lat:53.3790,lng:-6.1780,type:"manoeuvre",note:"Steep hill start"},{name:"Artane",lat:53.3837,lng:-6.2149,type:"hazard",note:"Lane position"},{name:"Coast",lat:53.3603,lng:-6.2000,type:"hazard",note:"Narrow + lane changes"},{name:"Ennafort",lat:53.3835,lng:-6.1680,type:"manoeuvre",note:"Turnabout"},{name:"Cill Eanna",lat:53.3796,lng:-6.1826,type:"manoeuvre",note:"Reverse"}],
    hazards:["Everything combined","40-minute fatigue","Tester may deviate"],
    tips:["Only after others done twice","Practice at expected test time","Handle this ‚Üí test feels easier"]},
];

const DL={1:"Starter",2:"Developing",3:"Intermediate",4:"Challenging",5:"Test Ready"};
const DC={1:"#22C55E",2:"#84CC16",3:"#F59E0B",4:"#F97316",5:"#EF4444"};
const DAY_Q={0:5,1:2,2:5,3:5,4:4,5:1,6:5};
const SLOTS=[{label:"Morning",stars:5},{label:"Evening",stars:3}];
const TARGET_HOURS=45;

function buildMapsUrl(r){return `https://www.google.com/maps/dir/?api=1&origin=${r.origin}&destination=${r.dest}&waypoints=${encodeURIComponent(r.addressWaypoints.join("|"))}&travelmode=driving`;}
function ls(k,v){if(v===undefined){try{const r=localStorage.getItem(k);return r?JSON.parse(r):null}catch{return null}}else{try{localStorage.setItem(k,JSON.stringify(v))}catch{}}}

function generatePlan(testDate){
  const today=new Date();today.setHours(0,0,0,0);
  const target=new Date(testDate);target.setHours(0,0,0,0);
  const totalDays=Math.max(0,Math.round((target-today)/86400000));
  if(totalDays<=0)return[];
  const sorted=[...ROUTES].sort((a,b)=>a.difficulty-b.difficulty);
  const phases=[{name:"Foundation",pct:.25,maxDiff:2,sessionMin:60},{name:"Building",pct:.25,maxDiff:3,sessionMin:75},{name:"Intensity",pct:.25,maxDiff:4,sessionMin:90},{name:"Final Prep",pct:.25,maxDiff:5,sessionMin:120}];
  const plan=[];let di=0,cumHrs=0;
  for(const ph of phases){
    const pd=Math.max(2,Math.round(totalDays*ph.pct));
    const available=sorted.filter(r=>r.difficulty<=ph.maxDiff);
    const ceiling=sorted.filter(r=>r.difficulty===ph.maxDiff);
    const pool=[];for(let i=0;i<pd*2;i++){if(i%5<3&&ceiling.length)pool.push(ceiling[i%ceiling.length]);else pool.push(available[i%available.length]);}
    let pi=0;
    for(let d=0;d<pd&&di<totalDays;d++){
      const date=new Date(today);date.setDate(date.getDate()+di);const dow=date.getDay();
      const isRest=dow===5&&(ph.name==="Foundation"||ph.name==="Building");
      if(isRest){plan.push({date:new Date(date),phase:ph.name,type:"rest",route:null,slot:null,focus:null,dq:DAY_Q[dow],sessDur:0,cumHrs});}
      else{const route=pool[pi%pool.length];pi++;cumHrs+=ph.sessionMin/60;plan.push({date:new Date(date),phase:ph.name,type:"practice",route,slot:dow===0?SLOTS[1]:SLOTS[0],focus:route.focus.slice(0,2),dq:DAY_Q[dow],sessDur:ph.sessionMin,cumHrs:Math.round(cumHrs*10)/10});}
      di++;
    }
  }
  const hard=sorted.filter(r=>r.difficulty>=4);
  while(di<totalDays){const date=new Date(today);date.setDate(date.getDate()+di);const route=hard[di%hard.length]||sorted[sorted.length-1];cumHrs+=2;plan.push({date:new Date(date),phase:"Final Prep",type:"practice",route,slot:SLOTS[0],focus:["test sim"],dq:DAY_Q[date.getDay()],sessDur:120,cumHrs:Math.round(cumHrs*10)/10});di++;}
  plan.push({date:new Date(target),phase:"Test Day",type:"test",route:null,slot:null,focus:["breathe"],dq:5,sessDur:0,cumHrs});
  return plan;
}

const fmt=d=>d.toLocaleDateString("en-IE",{weekday:"short",day:"numeric",month:"short"});
const fmtShort=d=>d.toLocaleDateString("en-IE",{day:"numeric",month:"short"});
const isToday=d=>{const t=new Date();t.setHours(0,0,0,0);const c=new Date(d);c.setHours(0,0,0,0);return c.getTime()===t.getTime();};
const isPast=d=>{const t=new Date();t.setHours(0,0,0,0);const c=new Date(d);c.setHours(0,0,0,0);return c<t;};
const PC=p=>({"Foundation":"#22C55E","Building":"#F59E0B","Intensity":"#F97316","Final Prep":"#EF4444","Test Day":"#0EA5E9"}[p]||"#94A3B8");

// ‚îÄ‚îÄ‚îÄ MINI MAP ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const MiniMap=({wps,sz=120})=>{
  if(!wps||wps.length<2)return null;
  const p=14,h=sz*.55,las=wps.map(w=>w.lat),lns=wps.map(w=>w.lng);
  const[mla,xla]=[Math.min(...las),Math.max(...las)],[mln,xln]=[Math.min(...lns),Math.max(...lns)];
  const rla=xla-mla||.005,rln=xln-mln||.005;
  const pr=(la,ln)=>({x:p+((ln-mln)/rln)*(sz-2*p),y:p+((xla-la)/rla)*(h-2*p)});
  const pts=wps.map(w=>pr(w.lat,w.lng));
  const d=pts.map((pt,i)=>`${i?"L":"M"} ${pt.x} ${pt.y}`).join(" ");
  const tc={start:"#0EA5E9",waypoint:"#CBD5E1",hazard:"#F59E0B",manoeuvre:"#8B5CF6"};
  return(<svg width={sz} height={h} viewBox={`0 0 ${sz} ${h}`} style={{borderRadius:"12px",background:"#F1F5F9"}}>
    <path d={d} fill="none" stroke="#0EA5E9" strokeWidth="2" strokeOpacity=".25" strokeLinecap="round" strokeDasharray="4 4"/>
    {pts.map((pt,i)=><circle key={i} cx={pt.x} cy={pt.y} r={wps[i].type==="start"?4:2.5} fill={tc[wps[i].type]||"#CBD5E1"} stroke="#F1F5F9" strokeWidth="1.5"/>)}
  </svg>);
};

// ‚îÄ‚îÄ‚îÄ PROGRESS RING ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Ring=({value,max,size=56,stroke=4,color="#0EA5E9",children})=>{
  const r=(size-stroke)/2,c=2*Math.PI*r,pct=Math.min(value/max,1);
  return(<div style={{position:"relative",width:size,height:size}}>
    <svg width={size} height={size} style={{transform:"rotate(-90deg)"}}><circle cx={size/2} cy={size/2} r={r} fill="none" stroke="#F1F5F9" strokeWidth={stroke}/><circle cx={size/2} cy={size/2} r={r} fill="none" stroke={color} strokeWidth={stroke} strokeLinecap="round" strokeDasharray={c} strokeDashoffset={c*(1-pct)} style={{transition:"stroke-dashoffset .6s ease"}}/></svg>
    <div style={{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center"}}>{children}</div>
  </div>);
};

// ‚îÄ‚îÄ‚îÄ DIFFICULTY PILL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Pill=({level,compact})=>(<span style={{display:"inline-flex",alignItems:"center",gap:"4px",padding:compact?"2px 8px":"3px 10px",borderRadius:"20px",fontSize:compact?"10px":"11px",fontWeight:600,background:DC[level]+"14",color:DC[level]}}>{compact?`L${level}`:DL[level]}</span>);

// ‚îÄ‚îÄ‚îÄ WAYPOINT ICON ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const WIcon=({type})=>{const m={start:["‚óè","#0EA5E9"],waypoint:["‚óã","#94A3B8"],hazard:["‚ñ≤","#F59E0B"],manoeuvre:["‚óÜ","#8B5CF6"]};const[ch,col]=m[type]||m.waypoint;return(<span style={{color:col,fontSize:"10px",lineHeight:1}}>{ch}</span>);};

// ‚îÄ‚îÄ‚îÄ CARD ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
const Card=({children,style:s,...p})=>(<div style={{background:"#fff",borderRadius:"16px",boxShadow:"0 1px 3px rgba(0,0,0,.04), 0 4px 12px rgba(0,0,0,.03)",padding:"16px",...s}} {...p}>{children}</div>);

// ‚îÄ‚îÄ‚îÄ MAIN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
function Drive(){
  const[view,setView]=useState("plan");
  const[testDate,setTestDate]=useState(()=>ls("drv-date"));
  const[centre,setCentre]=useState(()=>ls("drv-centre"));
  const[progress,setProgress]=useState(()=>ls("drv-prog")||{});
  const[expDay,setExpDay]=useState(null);
  const[expRoute,setExpRoute]=useState(null);
  const[dateInput,setDateInput]=useState(()=>ls("drv-date")||"");
  const[showSetup,setShowSetup]=useState(false);

  const apply=()=>{if(dateInput){setTestDate(dateInput);ls("drv-date",dateInput);}if(centre)ls("drv-centre",centre);setShowSetup(false);};
  const logRun=(rid,mins)=>{const np={...progress,[rid]:{runs:(progress[rid]?.runs||0)+1,mins:(progress[rid]?.mins||0)+(mins||0),last:new Date().toLocaleDateString("en-IE")}};setProgress(np);ls("drv-prog",np);};
  const reset=()=>{setProgress({});setTestDate(null);setCentre(null);setDateInput("");localStorage.removeItem("drv-date");localStorage.removeItem("drv-centre");localStorage.removeItem("drv-prog");};

  const plan=useMemo(()=>testDate?generatePlan(testDate):[],[testDate]);
  const daysLeft=useMemo(()=>{if(!testDate)return null;const n=new Date();n.setHours(0,0,0,0);const t=new Date(testDate);t.setHours(0,0,0,0);return Math.max(0,Math.round((t-n)/86400000));},[testDate]);
  const loggedMins=Object.values(progress).reduce((s,p)=>s+(p.mins||0),0);
  const loggedHrs=Math.round(loggedMins/6)/10;
  const totalRuns=Object.values(progress).reduce((s,p)=>s+(p.runs||0),0);
  const todayEntry=plan.find(p=>isToday(p.date));
  const curPhase=todayEntry?.phase||(plan.length?plan.find(p=>!isPast(p.date))?.phase:null);
  const planHrs=plan.length?plan[plan.length-1].cumHrs||0:0;
  const needsSetup=!testDate;

  // ‚îÄ‚îÄ‚îÄ SETUP MODAL ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // SetupModal inlined to prevent re-mount on state change

  // ‚îÄ‚îÄ‚îÄ TODAY HERO ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const TodayHero=()=>{
    if(!todayEntry||todayEntry.type==="rest")return null;
    if(todayEntry.type==="test")return(<Card className="fade-up" style={{background:"linear-gradient(135deg,#0EA5E9,#0284C7)",color:"#fff",marginBottom:"12px"}}>
      <div style={{fontSize:"13px",fontWeight:600,opacity:.8,marginBottom:"4px"}}>Today</div>
      <div style={{fontSize:"22px",fontWeight:800}}>Test Day</div>
      <p style={{fontSize:"13px",opacity:.8,marginTop:"6px",lineHeight:1.5}}>15 mins early. Phone loud until called, then off. 30-35 mins. You've done this.</p>
    </Card>);
    const r=todayEntry.route;if(!r)return null;
    return(<Card className="fade-up" style={{marginBottom:"12px",overflow:"hidden",padding:0}}>
      <div style={{padding:"16px 16px 12px"}}>
        <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
          <div>
            <div style={{fontSize:"12px",fontWeight:600,color:"#0EA5E9",marginBottom:"2px"}}>Today's Session</div>
            <div style={{fontSize:"18px",fontWeight:800,color:"#1A1A1A"}}>{r.name}</div>
            <div style={{display:"flex",gap:"8px",alignItems:"center",marginTop:"6px"}}>
              <Pill level={r.difficulty} compact/>
              <span style={{fontSize:"12px",color:"#94A3B8"}}>{todayEntry.sessDur}min ¬∑ {r.distance}</span>
            </div>
          </div>
          <MiniMap wps={r.waypoints} sz={80}/>
        </div>
        {todayEntry.focus&&<div style={{display:"flex",gap:"6px",marginTop:"10px",flexWrap:"wrap"}}>
          {todayEntry.focus.map(f=><span key={f} style={{fontSize:"11px",padding:"4px 10px",borderRadius:"20px",background:"#F1F5F9",color:"#64748B",fontWeight:500}}>{f}</span>)}
        </div>}
      </div>
      <div style={{display:"flex",borderTop:"1px solid #F1F5F9"}}>
        <a href={buildMapsUrl(r)} target="_blank" rel="noopener noreferrer" style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px",fontSize:"14px",fontWeight:700,color:"#0EA5E9",textDecoration:"none",borderRight:"1px solid #F1F5F9"}}>Open in Maps ‚Üó</a>
        <button onClick={()=>logRun(r.id,todayEntry.sessDur)} style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",padding:"14px",fontSize:"14px",fontWeight:700,color:"#22C55E",background:"none",border:"none",cursor:"pointer"}}>‚úì Log {todayEntry.sessDur}min</button>
      </div>
    </Card>);
  };

  // ‚îÄ‚îÄ‚îÄ STATS ROW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const Stats=()=>(<div className="fade-up" style={{display:"flex",gap:"8px",marginBottom:"12px",animationDelay:".05s"}}>
    <Card style={{flex:1,padding:"14px",display:"flex",alignItems:"center",gap:"12px"}}>
      <Ring value={daysLeft<=0?1:Math.max(0,1-daysLeft/30)} max={1} size={44} stroke={3.5} color={daysLeft<=7?"#EF4444":daysLeft<=21?"#F59E0B":"#0EA5E9"}>
        <span style={{fontSize:"14px",fontWeight:800,color:"#1A1A1A"}}>{daysLeft}</span>
      </Ring>
      <div><div style={{fontSize:"11px",color:"#94A3B8",fontWeight:500}}>Days left</div><div style={{fontSize:"12px",fontWeight:700,color:PC(curPhase)}}>{curPhase||"‚Äî"}</div></div>
    </Card>
    <Card style={{flex:1,padding:"14px",display:"flex",alignItems:"center",gap:"12px"}}>
      <Ring value={loggedHrs} max={TARGET_HOURS} size={44} stroke={3.5} color="#22C55E">
        <span style={{fontSize:"11px",fontWeight:800,color:"#1A1A1A"}}>{loggedHrs}</span>
      </Ring>
      <div><div style={{fontSize:"11px",color:"#94A3B8",fontWeight:500}}>Hours / {TARGET_HOURS}</div><div style={{fontSize:"12px",fontWeight:700,color:"#1A1A1A"}}>{totalRuns} runs</div></div>
    </Card>
  </div>);

  // ‚îÄ‚îÄ‚îÄ PLAN VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const PlanView=()=>{
    const grouped={};
    plan.forEach(d=>{const k=d.phase;if(!grouped[k])grouped[k]=[];grouped[k].push(d);});
    return(<div>
      <TodayHero/>
      <Stats/>
      {Object.entries(grouped).map(([phase,days],gi)=>(<div key={phase} className="fade-up" style={{marginBottom:"16px",animationDelay:`${.1+gi*.05}s`}}>
        <div style={{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px",padding:"0 4px"}}>
          <div style={{width:"8px",height:"8px",borderRadius:"50%",background:PC(phase)}}/>
          <span style={{fontSize:"13px",fontWeight:700,color:"#475569"}}>{phase}</span>
          <span style={{fontSize:"11px",color:"#CBD5E1"}}>{days.length} days</span>
        </div>
        <Card style={{padding:"4px 0"}}>
          {days.map((day,i)=>{
            const td=isToday(day.date),past=isPast(day.date)&&!td,exp=expDay===`${phase}-${i}`;
            const isTest=day.type==="test",isRest=day.type==="rest";
            return(<div key={i}>
              <div onClick={()=>!isRest&&setExpDay(exp?null:`${phase}-${i}`)}
                style={{display:"flex",alignItems:"center",gap:"10px",padding:"10px 16px",cursor:isRest?"default":"pointer",borderRadius:"12px",margin:"2px 4px",transition:"background .15s",background:td?"#F0F9FF":exp?"#F8FAFC":"transparent",opacity:past?.4:1}}
                onMouseEnter={e=>{if(!past&&!isRest)e.currentTarget.style.background=td?"#F0F9FF":"#F8FAFC"}} onMouseLeave={e=>{if(!exp&&!td)e.currentTarget.style.background="transparent"}}>
                <div style={{width:"40px",textAlign:"center",flexShrink:0}}>
                  <div style={{fontSize:"11px",fontWeight:td?700:500,color:td?"#0EA5E9":"#94A3B8"}}>{td?"Now":fmtShort(day.date)}</div>
                </div>
                <div style={{flex:1,minWidth:0}}>
                  {isTest?<span style={{fontSize:"14px",fontWeight:700,color:"#0EA5E9"}}>Test Day üéØ</span>
                  :isRest?<span style={{fontSize:"13px",color:"#CBD5E1"}}>Rest day</span>
                  :<div>
                    <div style={{fontSize:"14px",fontWeight:600,color:"#1A1A1A"}}>{day.route.name}</div>
                    <div style={{display:"flex",gap:"6px",alignItems:"center",marginTop:"2px"}}>
                      <span style={{fontSize:"11px",color:"#94A3B8"}}>{day.sessDur}min</span>
                      <Pill level={day.route.difficulty} compact/>
                    </div>
                  </div>}
                </div>
                {!isRest&&!isTest&&<svg width="16" height="16" viewBox="0 0 16 16" style={{flexShrink:0,transform:exp?"rotate(90deg)":"none",transition:"transform .2s"}}><path d="M6 4l4 4-4 4" fill="none" stroke="#CBD5E1" strokeWidth="2" strokeLinecap="round"/></svg>}
              </div>
              {exp&&day.route&&(<div className="fade-in" style={{padding:"0 16px 12px",marginTop:"-2px"}}>
                <div style={{padding:"12px 16px",background:"#F8FAFC",borderRadius:"12px"}}>
                  <p style={{fontSize:"12px",color:"#64748B",margin:"0 0 10px",lineHeight:1.5}}>{day.route.description}</p>
                  <div style={{display:"flex",flexDirection:"column",gap:"4px",marginBottom:"10px"}}>
                    {day.route.waypoints.map((wp,j)=>(<div key={j} style={{display:"flex",gap:"6px",alignItems:"flex-start"}}>
                      <WIcon type={wp.type}/><div><span style={{fontSize:"12px",fontWeight:500,color:"#334155"}}>{wp.name}</span>{wp.note&&<span style={{fontSize:"11px",color:"#94A3B8"}}> ‚Äî {wp.note}</span>}</div>
                    </div>))}
                  </div>
                  <div style={{display:"flex",gap:"8px"}}>
                    <a href={buildMapsUrl(day.route)} target="_blank" rel="noopener noreferrer" style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"10px",borderRadius:"10px",background:"#0EA5E9",color:"#fff",fontSize:"13px",fontWeight:700,textDecoration:"none"}}>Maps ‚Üó</a>
                    <button onClick={()=>logRun(day.route.id,day.sessDur)} style={{flex:1,padding:"10px",borderRadius:"10px",background:"#F0FDF4",border:"none",color:"#22C55E",fontSize:"13px",fontWeight:700,cursor:"pointer"}}>Log {day.sessDur}min ‚úì</button>
                  </div>
                </div>
              </div>)}
            </div>);
          })}
        </Card>
      </div>))}
    </div>);
  };

  // ‚îÄ‚îÄ‚îÄ ROUTES VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const RoutesView=()=>(<div style={{display:"flex",flexDirection:"column",gap:"8px"}}>
    {ROUTES.map((r,ri)=>{
      const p=progress[r.id],runs=p?.runs||0,exp=expRoute===r.id;
      return(<Card key={r.id} className="fade-up" style={{padding:0,overflow:"hidden",animationDelay:`${ri*.04}s`,cursor:"pointer"}}
        onClick={()=>setExpRoute(exp?null:r.id)}>
        <div style={{padding:"14px 16px",display:"flex",gap:"12px",alignItems:"center"}}>
          <div style={{flex:1,minWidth:0}}>
            <div style={{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"}}><Pill level={r.difficulty}/>{runs>0&&<span style={{fontSize:"12px",fontWeight:700,color:"#0EA5E9"}}>{runs}√ó</span>}</div>
            <div style={{fontSize:"16px",fontWeight:700,color:"#1A1A1A"}}>{r.name}</div>
            <div style={{fontSize:"12px",color:"#94A3B8",marginTop:"2px"}}>{r.centre} ¬∑ {r.duration}min ¬∑ {r.distance}</div>
          </div>
          <MiniMap wps={r.waypoints} sz={75}/>
        </div>
        {exp&&(<div className="fade-in" style={{padding:"0 16px 16px",borderTop:"1px solid #F1F5F9"}}>
          <p style={{fontSize:"12px",color:"#64748B",margin:"12px 0 10px",lineHeight:1.5}}>{r.description}</p>
          <div style={{display:"flex",flexDirection:"column",gap:"3px",marginBottom:"12px"}}>
            {r.waypoints.map((wp,j)=>(<div key={j} style={{display:"flex",gap:"6px",alignItems:"flex-start"}}><WIcon type={wp.type}/><div><span style={{fontSize:"12px",fontWeight:500,color:"#334155"}}>{wp.name}</span>{wp.note&&<span style={{fontSize:"11px",color:"#94A3B8"}}> ‚Äî {wp.note}</span>}</div></div>))}
          </div>
          <div style={{display:"flex",gap:"12px",flexWrap:"wrap",marginBottom:"12px"}}>
            <div style={{flex:"1 1 45%"}}><div style={{fontSize:"10px",fontWeight:700,color:"#F59E0B",letterSpacing:".5px",marginBottom:"4px"}}>HAZARDS</div>{r.hazards.map((h,j)=><div key={j} style={{fontSize:"11px",color:"#64748B",lineHeight:1.5}}>‚Ä¢ {h}</div>)}</div>
            <div style={{flex:"1 1 45%"}}><div style={{fontSize:"10px",fontWeight:700,color:"#0EA5E9",letterSpacing:".5px",marginBottom:"4px"}}>TIPS</div>{r.tips.map((t,j)=><div key={j} style={{fontSize:"11px",color:"#64748B",lineHeight:1.5}}>‚Üí {t}</div>)}</div>
          </div>
          <div style={{display:"flex",gap:"8px"}}>
            <a href={buildMapsUrl(r)} target="_blank" rel="noopener noreferrer" style={{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"12px",borderRadius:"12px",background:"#0EA5E9",color:"#fff",fontSize:"14px",fontWeight:700,textDecoration:"none"}} onClick={e=>e.stopPropagation()}>Open in Maps ‚Üó</a>
            <button onClick={e=>{e.stopPropagation();logRun(r.id,r.duration);}} style={{flex:1,padding:"12px",borderRadius:"12px",background:"#F0FDF4",border:"none",color:"#22C55E",fontSize:"14px",fontWeight:700,cursor:"pointer"}}>Log Run ‚úì</button>
          </div>
        </div>)}
      </Card>);
    })}
  </div>);

  // ‚îÄ‚îÄ‚îÄ REFERENCE VIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  const RefView=()=>(<div style={{display:"flex",flexDirection:"column",gap:"10px"}}>
    <Card className="fade-up">
      <h3 style={{fontSize:"16px",fontWeight:800,color:"#1A1A1A",margin:"0 0 12px"}}>When Stopped ‚Äî GOSHO</h3>
      <div style={{display:"flex",gap:"6px",flexWrap:"wrap"}}>
        {["Gear","Observation","Signal","Handbrake","Observation"].map((s,i)=><span key={i} style={{padding:"6px 12px",borderRadius:"20px",fontSize:"13px",fontWeight:600,background:"#F0F9FF",color:"#0EA5E9"}}>{s}</span>)}
      </div>
      <h3 style={{fontSize:"16px",fontWeight:800,color:"#1A1A1A",margin:"20px 0 12px"}}>Every Junction ‚Äî MSPSL</h3>
      <div style={{display:"flex",gap:"6px",flexWrap:"wrap"}}>
        {["Mirror","Signal","Position","Speed","Look"].map((s,i)=><span key={i} style={{padding:"6px 12px",borderRadius:"20px",fontSize:"13px",fontWeight:600,background:"#F5F3FF",color:"#8B5CF6"}}>{s}</span>)}
      </div>
    </Card>
    <Card className="fade-up" style={{animationDelay:".05s"}}>
      <h3 style={{fontSize:"14px",fontWeight:700,color:"#F59E0B",margin:"0 0 10px"}}>Common Fails</h3>
      {[{t:"Progress at Lights",d:"Not entering junction on green. Go to middle, wait, turn."},{t:"Roundabout Position",d:"Wrong lane at Artane. Read markings 50m ahead."},{t:"Observation",d:"No mirror before moving out or turning."},{t:"Clearance",d:"Too close to parked cars. 1m minimum."},{t:"Mini Roundabouts",d:"1st gear right turns. Yield right. Signal."}].map((f,i)=>(<div key={i} style={{marginBottom:i<4?"10px":0}}>
        <div style={{fontSize:"13px",fontWeight:700,color:"#334155"}}>{f.t}</div>
        <div style={{fontSize:"12px",color:"#94A3B8",lineHeight:1.5}}>{f.d}</div>
      </div>))}
    </Card>
    <Card className="fade-up" style={{animationDelay:".1s"}}>
      <h3 style={{fontSize:"14px",fontWeight:700,color:"#475569",margin:"0 0 10px"}}>Manoeuvre Locations</h3>
      <div style={{display:"grid",gridTemplateColumns:"repeat(3,1fr)",gap:"12px"}}>
        {[{t:"Turnabout",c:"#8B5CF6",s:["Ennafort","Avondale","Chelsea"]},{t:"Reverse",c:"#0EA5E9",s:["Cill Eanna","St Assam's","Baymount"]},{t:"Hill Start",c:"#F59E0B",s:["Raheny Hill","Brookwood","Mt Prospect"]}].map((m,i)=>(<div key={i}><div style={{fontSize:"12px",fontWeight:700,color:m.c,marginBottom:"4px"}}>{m.t}</div>{m.s.map(s=><div key={s} style={{fontSize:"11px",color:"#94A3B8",lineHeight:1.6}}>{s}</div>)}</div>))}
      </div>
    </Card>
    <Card className="fade-up" style={{animationDelay:".15s"}}>
      <h3 style={{fontSize:"14px",fontWeight:700,color:"#475569",margin:"0 0 6px"}}>Hours Guide</h3>
      <p style={{fontSize:"13px",color:"#64748B",lineHeight:1.6,margin:0}}>Most Irish learners need <strong style={{color:"#1A1A1A"}}>30‚Äì45 hours total</strong>. RSA mandates 12 EDT sessions minimum. This plan targets <strong style={{color:"#1A1A1A"}}>{TARGET_HOURS}h</strong> across {plan.filter(p=>p.type==="practice").length} sessions, building from 60 to 120 minutes.</p>
    </Card>
  </div>);

  // ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  return(<div style={{minHeight:"100vh",minHeight:"100dvh",background:"#FAFAF8"}}>
    {/* HEADER */}
    <div style={{position:"sticky",top:0,zIndex:50,background:"rgba(250,250,248,.85)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",padding:"14px 20px",borderBottom:"1px solid rgba(0,0,0,.04)"}}>
      <div style={{maxWidth:"600px",margin:"0 auto",display:"flex",justifyContent:"space-between",alignItems:"center"}}>
        <div style={{display:"flex",alignItems:"center",gap:"10px"}}>
          <h1 style={{fontSize:"20px",fontWeight:800,color:"#1A1A1A",margin:0}}>Drive</h1>
          {centre&&<span style={{fontSize:"11px",fontWeight:600,color:"#94A3B8",background:"#F1F5F9",padding:"3px 10px",borderRadius:"20px"}}>{centre}</span>}
        </div>
        <button onClick={()=>setShowSetup(true)} style={{width:"34px",height:"34px",borderRadius:"12px",border:"none",background:"#F1F5F9",color:"#64748B",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"background .2s"}} onMouseEnter={e=>e.currentTarget.style.background="#E2E8F0"} onMouseLeave={e=>e.currentTarget.style.background="#F1F5F9"}>‚öô</button>
      </div>
    </div>

    {(showSetup||needsSetup)&&<div className="fade-in" style={{position:"fixed",inset:0,background:"rgba(0,0,0,.3)",backdropFilter:"blur(12px)",WebkitBackdropFilter:"blur(12px)",zIndex:100,display:"flex",alignItems:"center",justifyContent:"center",padding:"24px"}}>
      <div className="fade-up" style={{background:"#fff",borderRadius:"24px",padding:"28px",maxWidth:"380px",width:"100%",boxShadow:"0 24px 48px rgba(0,0,0,.12)"}}>
        <h2 style={{fontSize:"22px",fontWeight:800,margin:"0 0 4px",color:"#1A1A1A"}}>{needsSetup?"Let's get started":"Settings"}</h2>
        <p style={{fontSize:"14px",color:"#94A3B8",margin:"0 0 24px"}}>{needsSetup?"Set your test date and centre.":"Adjust your plan."}</p>
        <label style={{fontSize:"12px",fontWeight:700,color:"#94A3B8",letterSpacing:".5px",display:"block",marginBottom:"6px"}}>TEST DATE</label>
        <input type="date" value={dateInput} onChange={e=>setDateInput(e.target.value)}
          style={{width:"100%",padding:"14px 16px",borderRadius:"12px",background:"#F8FAFC",border:"2px solid #E2E8F0",color:"#1A1A1A",fontSize:"16px",outline:"none",transition:"border .2s",marginBottom:"18px"}}
          onFocus={e=>e.target.style.borderColor="#0EA5E9"} onBlur={e=>e.target.style.borderColor="#E2E8F0"}/>
        <label style={{fontSize:"12px",fontWeight:700,color:"#94A3B8",letterSpacing:".5px",display:"block",marginBottom:"8px"}}>TEST CENTRE</label>
        <div style={{display:"flex",gap:"8px",marginBottom:"8px"}}>
          {[{v:"Killester",s:"~69% pass rate"},{v:"Raheny",s:"~48% pass rate"}].map(o=>(
            <button key={o.v} onClick={()=>setCentre(o.v)} style={{flex:1,padding:"14px 8px",borderRadius:"14px",border:`2px solid ${centre===o.v?"#0EA5E9":"#E2E8F0"}`,background:centre===o.v?"#F0F9FF":"#FAFAFA",cursor:"pointer",transition:"all .2s",textAlign:"center"}}>
              <div style={{fontSize:"15px",fontWeight:700,color:centre===o.v?"#0EA5E9":"#475569"}}>{o.v}</div>
              <div style={{fontSize:"11px",color:"#94A3B8",marginTop:"2px"}}>{o.s}</div>
            </button>))}
        </div>
        <p style={{fontSize:"11px",color:"#CBD5E1",margin:"0 0 20px",lineHeight:1.5}}>Both centres share the same test roads. All 8 routes available regardless.</p>
        <button onClick={apply} disabled={!dateInput} style={{width:"100%",padding:"16px",borderRadius:"14px",border:"none",fontSize:"16px",fontWeight:700,cursor:dateInput?"pointer":"not-allowed",background:dateInput?"#0EA5E9":"#E2E8F0",color:dateInput?"#fff":"#94A3B8",transition:"all .2s",marginBottom:"8px"}}>
          {needsSetup?"Generate Plan":"Save Changes"}
        </button>
        {!needsSetup&&<div style={{display:"flex",gap:"8px"}}>
          <button onClick={()=>setShowSetup(false)} style={{flex:1,padding:"14px",borderRadius:"14px",border:"2px solid #E2E8F0",background:"transparent",color:"#64748B",fontSize:"14px",fontWeight:600,cursor:"pointer"}}>Cancel</button>
          <button onClick={()=>{reset();setShowSetup(false);}} style={{flex:1,padding:"14px",borderRadius:"14px",border:"2px solid #FEE2E2",background:"#FFF5F5",color:"#EF4444",fontSize:"14px",fontWeight:600,cursor:"pointer"}}>Reset</button>
        </div>}
      </div>
    </div>}

    {/* CONTENT */}
    <div style={{maxWidth:"600px",margin:"0 auto",padding:"12px 16px 100px"}}>
      {view==="plan"&&testDate&&<PlanView/>}
      {view==="plan"&&!testDate&&<div style={{textAlign:"center",padding:"80px 20px"}}><div style={{fontSize:"40px",marginBottom:"12px"}}>üöó</div><h2 style={{fontSize:"18px",fontWeight:700,color:"#475569",marginBottom:"4px"}}>Ready to start?</h2><p style={{fontSize:"14px",color:"#94A3B8"}}>Set your test date to generate your plan.</p></div>}
      {view==="routes"&&<RoutesView/>}
      {view==="ref"&&<RefView/>}
    </div>

    {/* BOTTOM NAV */}
    <div style={{position:"fixed",bottom:0,left:0,right:0,background:"rgba(255,255,255,.9)",backdropFilter:"blur(16px)",WebkitBackdropFilter:"blur(16px)",borderTop:"1px solid rgba(0,0,0,.06)",padding:"8px 0 max(8px,env(safe-area-inset-bottom))",zIndex:50}}>
      <div style={{maxWidth:"600px",margin:"0 auto",display:"flex",justifyContent:"space-around"}}>
        {[{id:"plan",icon:"üìã",label:"Plan"},{id:"routes",icon:"üó∫",label:"Routes"},{id:"ref",icon:"üìñ",label:"Reference"}].map(t=>(
          <button key={t.id} onClick={()=>setView(t.id)} style={{display:"flex",flexDirection:"column",alignItems:"center",gap:"2px",padding:"6px 20px",borderRadius:"12px",border:"none",background:view===t.id?"#F0F9FF":"transparent",cursor:"pointer",transition:"all .2s"}}>
            <span style={{fontSize:"20px"}}>{t.icon}</span>
            <span style={{fontSize:"10px",fontWeight:view===t.id?700:500,color:view===t.id?"#0EA5E9":"#94A3B8"}}>{t.label}</span>
          </button>))}
      </div>
    </div>
  </div>);
}

ReactDOM.createRoot(document.getElementById("root")).render(<Drive/>);
</script>
</body>
</html>
